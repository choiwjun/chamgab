/**
 * 시군구 → 중심 좌표 매핑
 *
 * 용도:
 * 1. 지도 검색 시 초기 센터 결정
 * 2. PostGIS location이 NULL인 properties에 근사 좌표 부여
 *
 * 소스: ml-api/scripts/collect_poi_data.py REGION_COORDS + populate_complexes_properties.py ALL_SIGUNGU
 */

export const REGION_COORDS: Record<string, { lat: number; lng: number }> = {
  // ── 서울특별시 ──
  강남구: { lat: 37.5172, lng: 127.0473 },
  서초구: { lat: 37.4837, lng: 127.0324 },
  송파구: { lat: 37.5145, lng: 127.1059 },
  강동구: { lat: 37.5301, lng: 127.1238 },
  마포구: { lat: 37.5663, lng: 126.9014 },
  용산구: { lat: 37.5326, lng: 126.9901 },
  성동구: { lat: 37.5634, lng: 127.0369 },
  광진구: { lat: 37.5385, lng: 127.0824 },
  영등포구: { lat: 37.5264, lng: 126.8963 },
  강서구: { lat: 37.5509, lng: 126.8495 },
  양천구: { lat: 37.5169, lng: 126.8665 },
  구로구: { lat: 37.4954, lng: 126.8875 },
  금천구: { lat: 37.4568, lng: 126.8954 },
  동작구: { lat: 37.5124, lng: 126.9393 },
  관악구: { lat: 37.4784, lng: 126.9516 },
  서대문구: { lat: 37.5791, lng: 126.9368 },
  은평구: { lat: 37.6027, lng: 126.9291 },
  종로구: { lat: 37.5735, lng: 126.979 },
  중구: { lat: 37.5641, lng: 126.9979 },
  중랑구: { lat: 37.6063, lng: 127.0928 },
  동대문구: { lat: 37.5744, lng: 127.0396 },
  성북구: { lat: 37.5894, lng: 127.0167 },
  강북구: { lat: 37.6397, lng: 127.0255 },
  도봉구: { lat: 37.6688, lng: 127.0471 },
  노원구: { lat: 37.6542, lng: 127.0568 },

  // ── 경기도 ──
  가평군: { lat: 37.8313, lng: 127.5095 },
  과천시: { lat: 37.4292, lng: 126.9876 },
  광명시: { lat: 37.4786, lng: 126.8648 },
  광주시: { lat: 37.4295, lng: 127.2551 },
  구리시: { lat: 37.5943, lng: 127.1295 },
  군포시: { lat: 37.3616, lng: 126.9351 },
  김포시: { lat: 37.6152, lng: 126.7156 },
  남양주시: { lat: 37.636, lng: 127.2165 },
  동두천시: { lat: 37.9035, lng: 127.0607 },
  부천시: { lat: 37.5034, lng: 126.766 },
  시흥시: { lat: 37.38, lng: 126.803 },
  안성시: { lat: 37.0078, lng: 127.2797 },
  양주시: { lat: 37.7853, lng: 127.0458 },
  양평군: { lat: 37.4912, lng: 127.4875 },
  여주시: { lat: 37.2983, lng: 127.6363 },
  연천군: { lat: 38.0965, lng: 127.0747 },
  오산시: { lat: 37.1498, lng: 127.0693 },
  의왕시: { lat: 37.345, lng: 126.9685 },
  의정부시: { lat: 37.7381, lng: 127.0338 },
  이천시: { lat: 37.272, lng: 127.4349 },
  파주시: { lat: 37.76, lng: 126.78 },
  평택시: { lat: 36.9922, lng: 127.1128 },
  포천시: { lat: 37.8945, lng: 127.2002 },
  하남시: { lat: 37.5393, lng: 127.2142 },
  화성시: { lat: 37.1994, lng: 126.8312 },
  // 경기도 하위구
  권선구: { lat: 37.2573, lng: 127.0287 },
  기흥구: { lat: 37.275, lng: 127.115 },
  단원구: { lat: 37.3189, lng: 126.7968 },
  동안구: { lat: 37.3943, lng: 126.9516 },
  만안구: { lat: 37.3866, lng: 126.9267 },
  분당구: { lat: 37.3825, lng: 127.1189 },
  상록구: { lat: 37.301, lng: 126.8464 },
  수정구: { lat: 37.4502, lng: 127.1457 },
  수지구: { lat: 37.322, lng: 127.0987 },
  영통구: { lat: 37.2596, lng: 127.0563 },
  일산동구: { lat: 37.6585, lng: 126.7715 },
  일산서구: { lat: 37.6754, lng: 126.7509 },
  장안구: { lat: 37.304, lng: 127.0104 },
  중원구: { lat: 37.4306, lng: 127.1378 },
  팔달구: { lat: 37.2854, lng: 127.0191 },
  처인구: { lat: 37.2344, lng: 127.2 },
  덕양구: { lat: 37.6373, lng: 126.8326 },

  // ── 인천광역시 ──
  미추홀구: { lat: 37.4424, lng: 126.6993 },
  연수구: { lat: 37.41, lng: 126.6784 },
  남동구: { lat: 37.4488, lng: 126.731 },
  부평구: { lat: 37.5074, lng: 126.7218 },
  계양구: { lat: 37.5371, lng: 126.7378 },
  서구: { lat: 37.5454, lng: 126.676 },

  // ── 부산광역시 ──
  부산진구: { lat: 35.1631, lng: 129.0531 },
  동래구: { lat: 35.2048, lng: 129.0838 },
  해운대구: { lat: 35.1631, lng: 129.1635 },
  사하구: { lat: 35.1046, lng: 128.9749 },
  금정구: { lat: 35.2429, lng: 129.0922 },
  연제구: { lat: 35.1762, lng: 129.0799 },
  수영구: { lat: 35.1454, lng: 129.113 },
  사상구: { lat: 35.1525, lng: 128.991 },
  남구: { lat: 35.1368, lng: 129.0843 },
  북구: { lat: 35.1972, lng: 129.0301 },
  영도구: { lat: 35.0912, lng: 129.0679 },

  // ── 대구광역시 ──
  달서구: { lat: 35.8297, lng: 128.5328 },
  수성구: { lat: 35.8581, lng: 128.6308 },

  // ── 광주광역시 ──
  광산구: { lat: 35.1396, lng: 126.7937 },

  // ── 대전광역시 ──
  대덕구: { lat: 36.3467, lng: 127.4156 },
  유성구: { lat: 36.3622, lng: 127.3561 },

  // ── 울산광역시 ──
  울주군: { lat: 35.5224, lng: 129.2413 },

  // ── 세종특별자치시 ──
  세종시: { lat: 36.48, lng: 127.26 },

  // ── 충청북도 ──
  청주시: { lat: 36.6424, lng: 127.489 },
  충주시: { lat: 36.991, lng: 127.9259 },
  제천시: { lat: 37.1327, lng: 128.191 },

  // ── 충청남도 ──
  천안시: { lat: 36.8151, lng: 127.1139 },
  아산시: { lat: 36.7898, lng: 127.0018 },
  서산시: { lat: 36.7846, lng: 126.4504 },

  // ── 제주특별자치도 ──
  제주시: { lat: 33.4996, lng: 126.5312 },
  서귀포시: { lat: 33.2541, lng: 126.56 },

  // ── 시도 레벨 (검색어가 시도명일 때) ──
  서울: { lat: 37.5665, lng: 126.978 },
  서울특별시: { lat: 37.5665, lng: 126.978 },
  경기: { lat: 37.4138, lng: 127.5183 },
  경기도: { lat: 37.4138, lng: 127.5183 },
  인천: { lat: 37.4563, lng: 126.7052 },
  인천광역시: { lat: 37.4563, lng: 126.7052 },
  부산: { lat: 35.1796, lng: 129.0756 },
  부산광역시: { lat: 35.1796, lng: 129.0756 },
  대구: { lat: 35.8714, lng: 128.6014 },
  대구광역시: { lat: 35.8714, lng: 128.6014 },
  광주: { lat: 35.1595, lng: 126.8526 },
  광주광역시: { lat: 35.1595, lng: 126.8526 },
  대전: { lat: 36.3504, lng: 127.3845 },
  대전광역시: { lat: 36.3504, lng: 127.3845 },
  울산: { lat: 35.5384, lng: 129.3114 },
  울산광역시: { lat: 35.5384, lng: 129.3114 },
  세종: { lat: 36.48, lng: 127.26 },
  세종특별자치시: { lat: 36.48, lng: 127.26 },

  // ── 시 레벨 (경기도 등) ──
  수원시: { lat: 37.2636, lng: 127.0286 },
  수원: { lat: 37.2636, lng: 127.0286 },
  성남시: { lat: 37.42, lng: 127.1265 },
  성남: { lat: 37.42, lng: 127.1265 },
  안양시: { lat: 37.3943, lng: 126.9568 },
  안양: { lat: 37.3943, lng: 126.9568 },
  안산시: { lat: 37.3219, lng: 126.8309 },
  안산: { lat: 37.3219, lng: 126.8309 },
  고양시: { lat: 37.6584, lng: 126.832 },
  고양: { lat: 37.6584, lng: 126.832 },
  용인시: { lat: 37.2411, lng: 127.1776 },
  용인: { lat: 37.2411, lng: 127.1776 },
}

/**
 * 시(市) → 하위 구(區) 매핑
 *
 * 한국의 행정구역에서 구(區)를 가진 시(市) 전체 목록.
 * "안산" 검색 시 단원구+상록구 매물까지 포함하기 위한 확장용.
 */
export const CITY_TO_SIGUNGU: Record<string, string[]> = {
  // ── 경기도 ──
  수원: ['장안구', '권선구', '팔달구', '영통구'],
  수원시: ['장안구', '권선구', '팔달구', '영통구'],
  성남: ['수정구', '중원구', '분당구'],
  성남시: ['수정구', '중원구', '분당구'],
  안양: ['만안구', '동안구'],
  안양시: ['만안구', '동안구'],
  안산: ['단원구', '상록구'],
  안산시: ['단원구', '상록구'],
  고양: ['덕양구', '일산동구', '일산서구'],
  고양시: ['덕양구', '일산동구', '일산서구'],
  용인: ['처인구', '기흥구', '수지구'],
  용인시: ['처인구', '기흥구', '수지구'],
  // ── 충청북도 ──
  청주: ['상당구', '서원구', '흥덕구', '청원구'],
  청주시: ['상당구', '서원구', '흥덕구', '청원구'],
  // ── 충청남도 ──
  천안: ['동남구', '서북구'],
  천안시: ['동남구', '서북구'],
  // ── 전라북도 ──
  전주: ['완산구', '덕진구'],
  전주시: ['완산구', '덕진구'],
  // ── 경상북도 ──
  포항: ['남구', '북구'],
  포항시: ['남구', '북구'],
  // ── 경상남도 ──
  창원: ['의창구', '성산구', '마산합포구', '마산회원구', '진해구'],
  창원시: ['의창구', '성산구', '마산합포구', '마산회원구', '진해구'],
}

/**
 * 시(市) 이름에서 하위 구(區) 목록을 반환합니다.
 * 예: "안산" → ["단원구", "상록구"]
 */
export function expandCityToDistricts(query: string): string[] {
  if (!query) return []
  const q = query.trim()
  if (CITY_TO_SIGUNGU[q]) return CITY_TO_SIGUNGU[q]
  if (CITY_TO_SIGUNGU[q + '시']) return CITY_TO_SIGUNGU[q + '시']
  return []
}

/**
 * 검색어에서 지역 중심 좌표를 찾습니다.
 * 정확 매칭 → 부분 매칭(포함) 순서로 검색합니다.
 */
export function findRegionCenter(
  query: string
): { lat: number; lng: number } | null {
  if (!query) return null

  const q = query.trim()

  // 1. 정확 매칭
  if (REGION_COORDS[q]) {
    return REGION_COORDS[q]
  }

  // 2. "~시 ~구" 형태에서 구만 추출 (예: "안양시 동안구" → "동안구")
  const parts = q.split(/\s+/)
  for (const part of parts) {
    if (REGION_COORDS[part]) {
      return REGION_COORDS[part]
    }
  }

  // 3. 부분 매칭 (query가 key에 포함되거나 key가 query에 포함)
  for (const [key, coords] of Object.entries(REGION_COORDS)) {
    if (key.includes(q) || q.includes(key)) {
      return coords
    }
  }

  return null
}
