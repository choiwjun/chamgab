# S11 - 결제/플랜 선택
version: "2.0"
screen_id: S11
name: "결제/플랜 선택"
route: "/checkout/plans"
auth: true
priority: P1

description: |
  사용자가 프리미엄 구독을 선택하고 결제를 진행하는 화면.
  4가지 플랜 (Free, Premium Monthly, Premium Yearly, Business)을 비교하고,
  현재 구독 중인 플랜을 확인하며, 업그레이드/다운그레이드를 진행할 수 있다.

# 화면 구조
sections:
  - id: header
    name: 헤더
    description: 화면 제목 및 설명
    components:
      - title: "참값 프리미엄"
      - subtitle: "더 많은 분석과 기능으로 부동산 투자를 시작하세요"

  - id: period_toggle
    name: 결제 주기 토글
    description: 월간/연간 결제 선택
    components:
      - button_group:
          - label: "월간"
            value: monthly
          - label: "연간 (17% 할인)"
            value: yearly

  - id: plan_cards
    name: 플랜 카드 그리드
    description: 4개 플랜 카드 (2x2 그리드 또는 세로 스택)
    components:
      - PlanCard[] (Free, Premium Monthly, Premium Yearly, Business)

  - id: comparison_table
    name: 기능 비교 테이블
    description: 플랜별 기능 상세 비교
    components:
      - PlanComparison

# 플랜 정보
plans:
  - id: free
    name: "무료"
    price: 0
    currency: KRW
    period: month
    features:
      - name: "일일 참값 분석"
        value: "10회"
        included: true
      - name: "가격 요인 분석"
        value: "5개"
        included: true
      - name: "유사 거래 비교"
        value: "5개"
        included: true
      - name: "PDF 리포트"
        included: false
      - name: "팀 기능"
        included: false
      - name: "API 접근"
        included: false
      - name: "우선 지원"
        included: false
    is_recommended: false
    cta: "현재 플랜"

  - id: premium_monthly
    name: "프리미엄 월간"
    price: 9900
    currency: KRW
    period: month
    features:
      - name: "일일 참값 분석"
        value: "무제한"
        included: true
      - name: "가격 요인 분석"
        value: "10개"
        included: true
      - name: "유사 거래 비교"
        value: "20개"
        included: true
      - name: "PDF 리포트"
        included: true
      - name: "팀 기능"
        included: false
      - name: "API 접근"
        included: false
      - name: "우선 지원"
        included: false
    is_recommended: true
    badge: "가장 인기"
    cta: "시작하기"

  - id: premium_yearly
    name: "프리미엄 연간"
    price: 99000
    currency: KRW
    period: year
    original_price: 118800
    discount_rate: 17
    features:
      - name: "일일 참값 분석"
        value: "무제한"
        included: true
      - name: "가격 요인 분석"
        value: "10개"
        included: true
      - name: "유사 거래 비교"
        value: "20개"
        included: true
      - name: "PDF 리포트"
        included: true
      - name: "팀 기능"
        included: false
      - name: "API 접근"
        included: false
      - name: "우선 지원"
        included: false
    is_recommended: false
    badge: "2개월 무료"
    cta: "시작하기"

  - id: business
    name: "비즈니스"
    price: 49900
    currency: KRW
    period: month
    features:
      - name: "일일 참값 분석"
        value: "무제한"
        included: true
      - name: "가격 요인 분석"
        value: "무제한"
        included: true
      - name: "유사 거래 비교"
        value: "무제한"
        included: true
      - name: "PDF 리포트"
        included: true
      - name: "팀 기능"
        value: "5명"
        included: true
      - name: "API 접근"
        included: true
      - name: "우선 지원"
        included: true
    is_recommended: false
    cta: "문의하기"

# 사용자 상호작용
interactions:
  - id: change_period
    trigger: 월간/연간 토글 클릭
    action: 플랜 카드 가격 업데이트 (애니메이션)

  - id: select_plan
    trigger: 플랜 카드 CTA 버튼 클릭
    flow:
      - if: 현재 플랜
        then: 아무 동작 없음
      - else_if: Free 플랜
        then: 아무 동작 없음 (이미 Free)
      - else:
        then: Toss Payments 결제창 열기 (Mock)

  - id: payment_success
    trigger: 결제 성공 콜백
    action: /checkout/success?plan={plan_id} 리다이렉트

  - id: payment_fail
    trigger: 결제 실패 콜백
    action: Toast 에러 메시지 표시

# 상태 관리
state:
  - period: 'monthly' | 'yearly'
  - currentPlanId: string (현재 사용자 구독 플랜)
  - isLoading: boolean (결제 진행 중)

# API 연동
api_calls:
  - name: 현재 구독 정보 조회
    endpoint: GET /api/subscriptions/current
    response:
      plan_id: string
      status: 'active' | 'cancelled' | 'past_due'
      period_end: ISO8601 timestamp

  - name: 결제 세션 생성
    endpoint: POST /api/payments/create-session
    request:
      plan_id: string
      period: 'monthly' | 'yearly'
    response:
      payment_url: string
      order_id: string

# 반응형
responsive:
  mobile:
    - 플랜 카드: 세로 스택 (1열)
    - 비교 테이블: 가로 스크롤
  tablet:
    - 플랜 카드: 2x2 그리드
  desktop:
    - 플랜 카드: 가로 4열 그리드
    - 비교 테이블: 전체 표시

# 접근성
accessibility:
  - 플랜 카드 선택 시 키보드 네비게이션 (Tab/Enter)
  - 스크린 리더: 가격, 기능, 현재 플랜 상태 읽기
  - 포커스 인디케이터 명확히 표시

# 디자인 노트
design_notes:
  - 추천 플랜은 border-primary + 배지
  - 현재 플랜은 CTA 버튼 disabled + 배경색 변경
  - 가격은 큰 폰트 + 굵게 (2rem)
  - 연간 플랜 선택 시 원가 취소선 + 할인율 강조
