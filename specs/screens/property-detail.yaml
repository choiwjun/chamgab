# S04: ë§¤ë¬¼ ìƒì„¸ (í•µì‹¬ í™”ë©´)
version: "2.0"

screen:
  id: S04
  name: ë§¤ë¬¼ ìƒì„¸
  route: /property/[id]
  layout: single-column
  auth_required: partial  # ì°¸ê°’ ë¶„ì„ ì‹œ í•„ìš”
  description: ë§¤ë¬¼ ìƒì„¸ ì •ë³´ ë° ì°¸ê°’ ë¶„ì„

data_requirements:
  - resource: properties
    needs: [id, name, address, property_type, area_exclusive, built_year, floors, images, location, sido, sigungu, eupmyeondong]
    params: { id: "[id]" }
    description: ë§¤ë¬¼ ê¸°ë³¸ ì •ë³´

  - resource: chamgab_analyses
    needs: [chamgab_price, min_price, max_price, confidence, confidence_level, analyzed_at, valid_until]
    params: { property_id: "[id]" }
    auth_required: true
    rate_limit:
      guest: 3/day
      free: 10/day
      premium: unlimited
    description: ì°¸ê°’ ë¶„ì„ ê²°ê³¼

  - resource: price_factors
    needs: [rank, factor_name, factor_category, contribution, contribution_pct, direction, description]
    params: { analysis_id: "{analysis.id}" }
    limit:
      free: 5
      premium: 10
    description: ê°€ê²© ì˜í–¥ ìš”ì¸

  - resource: transactions
    needs: [id, property_name, price, transaction_date, area_exclusive, floor, distance, similarity]
    params: { property_id: "[id]" }
    limit: 10
    description: ìœ ì‚¬ ê±°ë˜ ë‚´ì—­

  - resource: favorites
    needs: [id]
    params: { property_id: "[id]" }
    auth_required: true
    description: ê´€ì‹¬ ë§¤ë¬¼ ì—¬ë¶€

components:
  - id: header
    type: sticky-header
    position: top
    function: ë§¤ë¬¼ëª…, ì£¼ì†Œ, ê°€ê²©
    props:
      fields: [name, address, chamgab_price]

  - id: image_gallery
    type: gallery
    position: top
    function: ë§¤ë¬¼ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬
    data_source:
      resource: properties
      field: images
    props:
      swipeable: true
      indicator: dots

  - id: chamgab_card
    type: analysis-card
    position: main
    function: ì°¸ê°’ ë¶„ì„ ì¹´ë“œ (í•µì‹¬)
    data_source:
      resource: chamgab_analyses
    props:
      layout: |
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ğŸ“Š ì°¸ê°’ ë¶„ì„ ë¦¬í¬íŠ¸                     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚         ì°¸ê°’: {chamgab_price}           â”‚
        â”‚       ({min_price} ~ {max_price})       â”‚
        â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ ì‹ ë¢°ë„ {confidence}%  â”‚
        â”‚  â±ï¸ ë¶„ì„ì¼: {analyzed_at} (ìœ íš¨: 7ì¼)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      empty_state:
        guest: "ë¡œê·¸ì¸ í›„ ì°¸ê°’ì„ í™•ì¸í•˜ì„¸ìš”"
        limit_reached: "ì˜¤ëŠ˜ ë¬´ë£Œ ë¶„ì„ì„ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤"

  - id: price_factors_list
    type: ranked-list
    position: main
    function: ê°€ê²© ì˜í–¥ ìš”ì¸ Top N
    data_source:
      resource: price_factors
    props:
      show_rank: true
      show_contribution: true
      premium_upsell:
        free_count: 5
        message: "í”„ë¦¬ë¯¸ì—„ì—ì„œ 10ê°œ ìš”ì¸ ëª¨ë‘ í™•ì¸"

  - id: similar_transactions
    type: comparison-table
    position: main
    function: ìœ ì‚¬ ê±°ë˜ ë¹„êµ í…Œì´ë¸”
    data_source:
      resource: transactions
    props:
      columns: [property_name, price, transaction_date, area_exclusive, floor, similarity]
      sortable: true

  - id: location_map
    type: mini-map
    position: main
    function: ì…ì§€ ë¶„ì„ ì§€ë„
    data_source:
      resource: properties
      field: location
    props:
      show_poi: [subway, school, park, hospital]
      radius: 1km

  - id: detail_table
    type: key-value-table
    position: main
    function: ìƒì„¸ ì •ë³´ í…Œì´ë¸”
    props:
      fields:
        - { key: property_type, label: ë¶€ë™ì‚° ìœ í˜• }
        - { key: area_exclusive, label: ì „ìš©ë©´ì  }
        - { key: built_year, label: ê±´ì¶•ë…„ë„ }
        - { key: floors, label: ì¸µìˆ˜ }

  - id: cta_buttons
    type: button-group
    position: sticky-bottom
    function: CTA ë²„íŠ¼
    children:
      - id: favorite_btn
        type: icon-button
        function: ê´€ì‹¬ ë§¤ë¬¼ ì €ì¥
        props:
          icon: heart
          toggle: true
        auth_required: true

      - id: compare_btn
        type: button
        function: ë¹„êµí•˜ê¸° ì¶”ê°€
        props:
          label: ë¹„êµ ì¶”ê°€
          variant: outline

connections:
  - from: favorite_btn
    action: click
    to:
      - if_not_auth: /auth/login?redirect=/property/{id}
      - if_auth: POST /api/favorites

  - from: compare_btn
    action: click
    to: ë¹„êµ ëª©ë¡ì— ì¶”ê°€ â†’ /compare?ids={ids}

  - from: similar_transactions.row
    action: click
    to: /property/{transaction.property_id}

  - from: chamgab_card
    action: limit_reached
    to: /checkout/plans ëª¨ë‹¬ í‘œì‹œ

tests:
  - name: ì´ˆê¸° ë¡œë“œ
    when: /property/{id} ì ‘ì†
    then:
      - ë§¤ë¬¼ ê¸°ë³¸ ì •ë³´ í‘œì‹œ
      - ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ í‘œì‹œ
      - ì°¸ê°’ ë¶„ì„ ì¹´ë“œ í‘œì‹œ (ë¡œê·¸ì¸ ì‹œ)

  - name: ë¹„íšŒì› ì°¸ê°’ ì¡°íšŒ
    when: ë¹„íšŒì› ìƒíƒœì—ì„œ ì°¸ê°’ í™•ì¸
    then:
      - 3íšŒê¹Œì§€ ì¡°íšŒ ê°€ëŠ¥
      - 4íšŒì§¸ ë¡œê·¸ì¸ ìœ ë„ ëª¨ë‹¬

  - name: ë¬´ë£ŒíšŒì› í•œë„ ì´ˆê³¼
    when: ì¼ì¼ 10íšŒ ë¶„ì„ í›„ ì¶”ê°€ ìš”ì²­
    then:
      - í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ ëª¨ë‹¬ í‘œì‹œ
      - "ì˜¤ëŠ˜ ë¬´ë£Œ ë¶„ì„ì„ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€

  - name: ê´€ì‹¬ ë§¤ë¬¼ ì €ì¥
    when: í•˜íŠ¸ ë²„íŠ¼ í´ë¦­ (ë¡œê·¸ì¸ ìƒíƒœ)
    then:
      - ê´€ì‹¬ ë§¤ë¬¼ì— ì¶”ê°€
      - í† ìŠ¤íŠ¸ "ê´€ì‹¬ ë§¤ë¬¼ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤"
